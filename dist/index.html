<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ScrollTrigger: SVG Text Mask</title>
  <link rel="stylesheet" href="https://public.codepenassets.com/css/normalize-5.0.0.min.css" />
  <!-- CSS del subdominio -->
  <link rel="stylesheet" href="./style.css" />
  <!-- CSS del sitio (navbar/footer) -->
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>

  <!-- Navbar (inyectado al inicio) -->
  <div id="navbar"></div>

  <!-- 拘勇 TODO lo del subdominio encapsulado para no romper el sitio -->
  <div id="snv">
    <div class="scrollDist"></div>

    <main>
      <svg viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice">
        <mask id="m">
          <g class="cloud1">
            <rect fill="#fff" width="100%" height="801" y="799" />
            <image xlink:href="https://assets.codepen.io/721952/cloud1Mask.jpg" width="1200" height="800"/>
          </g>
        </mask>
        <image class="sky"     xlink:href="https://assets.codepen.io/721952/sky.jpg"    width="1200" height="590" />
        <image class="mountBg" xlink:href="https://assets.codepen.io/721952/mountBg.png" width="1200" height="800"/>
        <image class="mountMg" xlink:href="https://assets.codepen.io/721952/mountMg.png" width="1200" height="800"/>
        <image class="cloud2"  xlink:href="https://assets.codepen.io/721952/cloud2.png"  width="1200" height="800"/>
        <image class="mountFg" xlink:href="https://assets.codepen.io/721952/mountFg.png" width="1200" height="800"/>
        <image class="cloud1"  xlink:href="https://assets.codepen.io/721952/cloud1.png"  width="1200" height="800"/>
        <image class="cloud3"  xlink:href="https://assets.codepen.io/721952/cloud3.png"  width="1200" height="800"/>
        <text fill="#fff" x="600" y="200" text-anchor="middle">SNOWLINES</text>
        <polyline class="arrow" fill="#fff"
          points="599,250 599,289 590,279 590,282 600,292 610,282 610,279 601,289 601,250" />
        <g mask="url(#m)">
          <rect fill="#fff" width="100%" height="100%"/>
          <text x="600" y="200" fill="#162a43" text-anchor="middle">SIERRA NEVADA</text>
        </g>
        <rect id="arrow-btn" width="100" height="100" opacity="0" x="550" y="220" style="cursor:pointer"/>
      </svg>
    </main>

    <section id="map-section">
      <div id="map-wrapper">
        <img src="Gemini_Generated_Image_7pn6pj7pn6pj7pn6.png" alt="Mapa de pistas de Sierra Nevada" />

        <!-- (corregido: este bot칩n no ten칤a cierre) -->
        <button class="map-point"
                style="top: 90%; left: 26%;"
                data-title="Punto de encuentro"
                data-description="Aqu칤 nos reuniremos antes de comenzar la clase.<br><br><a href='https://share.google/bis23CChISdAAlEdj' target='_blank' style='color:#007bff; text-decoration:underline;'>Abrir en Mapas</a>游늸">
        </button>

        <button class="map-point"
                style="top: 70%; left: 47%;"
                data-title="Pistas Verdes"
                data-description="Las 19 pistas verdes son ideales para aquellos que est치n dando sus primeros pasos en la nieve. Dise침adas para proporcionar una experiencia de aprendizaje segura y c칩moda.">
        </button>

        <button class="map-point"
                style="top: 48%; left: 75%;"
                data-title="Pistas Azules"
                data-description="Terreno f치cil y perfecto para esquiadores y snowboarders que ya dominan los fundamentos. Estas pistas presentan una pendiente moderada y un trazado predecible.">
        </button>

        <div id="map-popup"></div>
      </div>
    </section>
  </div>
  <!-- 拘勇 Fin encapsulado -->

  <!-- Footer (inyectado al final) -->
  <div id="footer"></div>

  <!-- GSAP y l칩gica del subdominio -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/gsap@3/dist/ScrollToPlugin.min.js"></script>
  <script src="./script.js"></script>

  <!-- Inyecci칩n de navbar/footer + comportamiento sticky del nav -->
  <script>
    (function(){
      function fixPaths(html){
        // Ajustar rutas relativas desde /dist a /assets en los parciales
        html = html.replace(/src="assets\//g, 'src="../assets/');
        html = html.replace(/href="assets\//g, 'href="../assets/');
        html = html.replace(/'assets\//g, "'../assets/");
        return html;
      }
      function wireMenu(){
        var btn  = document.getElementById('menu-btn');
        var list = document.getElementById('navlist');
        var bar  = document.querySelector('.topbar');
        if(bar){
          var setOffset = function(){
            var h = bar.offsetHeight || 72;
            document.documentElement.style.setProperty('--nav-h', h + 'px');
          };
          var onScroll = function(){
            bar.classList.toggle('scrolled', window.scrollY > 10);
          };
          setOffset(); onScroll();
          window.addEventListener('resize', setOffset);
          window.addEventListener('scroll', onScroll, {passive:true});
        }
        if(btn && list){
          btn.addEventListener('click', function(){
            var open = list.classList.toggle('open');
            btn.setAttribute('aria-expanded', open ? 'true' : 'false');
          });
        }
      }
      function inject(id, url){
        var slot = document.getElementById(id);
        if(!slot) return Promise.resolve();
        return fetch(url).then(function(r){return r.text()}).then(function(html){
          slot.innerHTML = fixPaths(html);
          if(id === 'navbar') wireMenu();
        });
      }
      inject('navbar', '../partials/navbar.html');
      inject('footer', '../partials/footer.html');
    })();
  </script>
</body>
</html>
